#include "stdint.h"
#include "spyro_cdrom.h"
#include "psx_mem.h"

uint32_t wad_main_header[][2] =
{
  {0x00000800, 0x0001B000},
  {0x0001B800, 0x00040000},
  {0x0005B800, 0x00003800},
  {0x0005F000, 0x00130000}, // start menu subwad
  {0x0018F000, 0x0024F000}, // new game subwad
  {0x003DE000, 0x001B2000}, // gnasty gnorc credits subwad
  {0x00590000, 0x0021E800}, // gnastys loot credits subwad
  {0x007AE800, 0x0000A000},
  {0x007B8800, 0x0003A000},
  {0x007F2800, 0x0000E000}, // artisans exe
  {0x00800800, 0x00383000}, // artisans subwad
  {0x00B83800, 0x00010000}, // stone hill exe
  {0x00B93800, 0x00362800}, // stone hill subwad
  {0x00EF6000, 0x0000B000},
  {0x00F01000, 0x0028D800}, // subwad
  {0x0118E800, 0x0000F800},
  {0x0119E000, 0x002E2000}, // subwad
  {0x01480000, 0x0000A000},
  {0x0148A000, 0x0021E000}, // subwad
  {0x016A8000, 0x0000A800},
  {0x016B2800, 0x001CB800}, // subwad
  {0x0187E000, 0x00012800},
  {0x01890800, 0x0029E800}, // subwad
  {0x01B2F000, 0x00013000},
  {0x01B42000, 0x002C0000}, // subwad
  {0x01E02000, 0x00011800},
  {0x01E13800, 0x00286800}, // subwad
  {0x0209A000, 0x0000C000},
  {0x020A6000, 0x002D7000}, // subwad
  {0x0237D000, 0x0000C800},
  {0x02389800, 0x00206000}, // subwad
  {0x0258F800, 0x00009800},
  {0x02599000, 0x0018E000}, // subwad
  {0x02727000, 0x00014000},
  {0x0273B000, 0x002BE800}, // subwad
  {0x029F9800, 0x00013800},
  {0x02A0D000, 0x0029F800}, // subwad
  {0x02CAC800, 0x00012000},
  {0x02CBE800, 0x0029C800}, // subwad
  {0x02F5B000, 0x00010000},
  {0x02F6B000, 0x0028A000}, // subwad
  {0x031F5000, 0x0000D000},
  {0x03202000, 0x001DD800}, // subwad
  {0x033DF800, 0x0000A000},
  {0x033E9800, 0x001A2800}, // subwad
  {0x0358C000, 0x00010800},
  {0x0359C800, 0x00256000}, // subwad
  {0x037F2800, 0x0000D000},
  {0x037FF800, 0x0026E800}, // subwad
  {0x03A6E000, 0x0000C800},
  {0x03A7A800, 0x002FE800}, // subwad
  {0x03D79000, 0x0000F000},
  {0x03D88000, 0x0029C800}, // subwad
  {0x04024800, 0x00010000},
  {0x04034800, 0x00222000}, // subwad
  {0x04256800, 0x0000A000},
  {0x04260800, 0x0017A800}, // subwad
  {0x043DB000, 0x00011800},
  {0x043EC800, 0x0028D800}, // subwad
  {0x0467A000, 0x0000D800},
  {0x04687800, 0x002B4800}, // subwad
  {0x0493C000, 0x0000D000},
  {0x04949000, 0x00217800}, // subwad
  {0x04B60800, 0x0000F000},
  {0x04B6F800, 0x00280800}, // subwad
  {0x04DF0000, 0x0000C000},
  {0x04DFC000, 0x00233800}, // subwad
  {0x0502F800, 0x0000A000},
  {0x05039800, 0x001A9800}, // subwad
  {0x051E3000, 0x0000B800},
  {0x051EE800, 0x0025B800}, // subwad
  {0x0544A000, 0x0000E000},
  {0x05458000, 0x00271800}, // subwad
  {0x056C9800, 0x0000B800},
  {0x056D5000, 0x0023C800}, // subwad
  {0x05911800, 0x0000B000},
  {0x0591C800, 0x001CE000}, // subwad
  {0x05AEA800, 0x0000C000},
  {0x05AF6800, 0x001A1000}, // subwad
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x05C97800, 0x00002000},
  {0x05C99800, 0x000F9800}, // subwad
  {0x05D93000, 0x000A0000},
  {0x05E33000, 0x00094800},
  {0x05EC7800, 0x0007F800},
  {0x05F47000, 0x0009D800},
  {0x05FE4800, 0x00086800},
  {0x0606B000, 0x00086800},
  {0x060F1800, 0x000B4000},
  {0x061A5800, 0x00083000},
  {0x06228800, 0x00094000},
  {0x062BC800, 0x000E4000}, // subwad
  {0x063A0800, 0x00089800},
  {0x0642A000, 0x00086000},
  {0x064B0000, 0x00096800},
  {0x06546800, 0x00085000},
  {0x065CB800, 0x0008A000},
  {0x06655800, 0x000B1800},
  {0x06707000, 0x000B4800},
  {0x067BB800, 0x000BC000},
  {0x06877800, 0x000AF800},
};

uint32_t main_menu[][2] =
{
  {0x00000800, 0x000C7800},
  {0x000C8000, 0x00021800},
  {0x000E9800, 0x00040000},
  {0x00129800, 0x00006800},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x000E9800, 0x0010FB50},
  {0x001236C0, 0x00124BF4},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x04070406, 0x041D0408},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
};

uint32_t artisans_subwad[][2] =
{
  {0x00000800, 0x000EE000},
  {0x000EE800, 0x0008D800},
  {0x0017C000, 0x0004D800},
  {0x001C9800, 0x00014800},
  {0x001DE000, 0x00058800},
  {0x00236800, 0x00049800},
  {0x00280000, 0x0003A000},
  {0x002BA000, 0x00067000},
  {0x00321000, 0x00062000},
  {0x00000000, 0x00000000},
  {0x0017C000, 0x00186194},
  {0x001868D4, 0x001881F4},
  {0x001885AC, 0x00188B8C},
  {0x001941CC, 0x001A9CB8},
  {0x001AD0D8, 0x001AE664},
  {0x001AEA4C, 0x001AEB50},
  {0x001AF104, 0x001B0140},
  {0x001B092C, 0x001B6F7C},
  {0x001B9910, 0x001BA0A4},
  {0x001BAA9C, 0x001BB214},
  {0x001BB83C, 0x001C11F0},
  {0x001C1520, 0x001C1694},
  {0x001C1E00, 0x001C4338},
  {0x001C4AC4, 0x001C73F4},
  {0x001C7550, 0x001C7654},
  {0x001C77C8, 0x001C793C},
  {0x001C7C68, 0x001C7DC4},
  {0x001C95F0, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x01950000, 0x00AC01DD},
  {0x0153015C, 0x00BB0072},
  {0x00C201A0, 0x014B01A8},
  {0x000E01A5, 0x01500156},
  {0x01630162, 0x00950164},
  {0x0010000A, 0x001201F5},
  {0x000F006E, 0x00FF0078},
  {0x01010100, 0x01A601A9},
  {0x00FA01A7, 0x000000FB},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
};

uint32_t stone_hill_subwad[][2] =
{
  {0x00000800, 0x000F5800},
  {0x000F6000, 0x00098800},
  {0x0018E800, 0x00050800},
  {0x001DF000, 0x0000C000},
  {0x001EB000, 0x00059000},
  {0x00244000, 0x00062000},
  {0x002A6000, 0x00053800},
  {0x002F9800, 0x00069000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x0018E800, 0x001A0AE4},
  {0x001A4B40, 0x001A5280},
  {0x001A6BA0, 0x001A812C},
  {0x001B4D20, 0x001BA6D4},
  {0x001BAA04, 0x001BB164},
  {0x001BB54C, 0x001CCF40},
  {0x001CD378, 0x001CD730},
  {0x001CDDA8, 0x001CE41C},
  {0x001CECE0, 0x001CFCE8},
  {0x001CFDEC, 0x001D03A0},
  {0x001D4C8C, 0x001D5CC8},
  {0x001D64B4, 0x001D6D1C},
  {0x001D9254, 0x001D99E0},
  {0x001DC310, 0x001DC46C},
  {0x001DC570, 0x001DC6E4},
  {0x001DC908, 0x001DCADC},
  {0x001DCDB4, 0x001DCF28},
  {0x001DD254, 0x001DD3B0},
  {0x001DEBDC, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00EA0000, 0x01DD0195},
  {0x007901A0, 0x0010000A},
  {0x00C20080, 0x00C30071},
  {0x00DE00AC, 0x00E000DF},
  {0x01A800AE, 0x0021014B},
  {0x000E01A5, 0x006E0009},
  {0x0078000F, 0x010000FF},
  {0x01350101, 0x01370136},
  {0x01A601A9, 0x00FA01A7},
  {0x000000FB, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
  {0x00000000, 0x00000000},
};

void read_disk_wad(uint32_t entry, uint32_t offset)
{
  read_disk1(0x25, 0x80100000 - 0x800, 0x800, wad_main_header[entry][0] + offset, 0x258);
}

int is_subwad(uint32_t entry, uint32_t offset)
{
  if (wad_main_header[entry][0] == 0 || wad_main_header[entry][1] == 0) return 0;

  read_disk_wad(entry, offset);
  int addr1 = lw(0x80100000 - 0x800 + 0);
  int len1 = lw(0x80100000 - 0x800 + 4);
  int addr2 = lw(0x80100000 - 0x800 + 8);
  int len2 = lw(0x80100000 - 0x800 + 12);

  if (addr1 != 0x800) return 0;
  if ((addr1 | len1 | addr2 | len2) == 0) return 0;
  if ((addr1 | len1 | addr2 | len2) & 0x7FF) return 0;
  if (addr1 + len1 != addr2) return 0;

  return 1;
}

void wad_header_info(char *name, uint32_t offset, uint32_t entries)
{
  read_disk1(0x25, 0x80100000, 0x800, offset, 0x258);

  printf("uint32_t %s[][2] =\n{\n", name);
  for (int i = 0; i < entries; i++)
  {
    printf("  {0x%.8X, 0x%.8X},", lw(0x80100000 + i*8), lw(0x80100000 + i*8 + 4));
    if (is_subwad(i, offset)) printf(" // subwad");
    printf("\n");
  }
  printf("};\n");
}

void wad_main(void)
{
  //wad_header_info("artisans_subwad", 0, 0x66);
  wad_header_info("stone_hill_subwad", 0x00B93800, 0x3A);
}